<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Clicker</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f4f4f4;
            text-align: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        h1 { font-size: 3em; margin: 0.2em 0; }
        h2 { margin-top: 2em; }
        #cookie {
            width: 220px;
            cursor: pointer;
            transition: transform 0.1s ease;
        }
        #cookie:active { transform: scale(0.95); }
        #score, #clickValue, #autoClickerStatus {
            font-size: 1.2em;
            margin: 10px 0;
        }
        .section { margin-top: 30px; }
        .button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
        }
        .button:hover { background-color: #2980b9; }
        .achievement {
            font-size: 1em;
            margin: 5px;
            color: gray;
        }
        .unlocked {
            color: green;
            font-weight: bold;
        }
        .particle {
            position: absolute;
            font-weight: bold;
            color: gold;
            pointer-events: none;
            user-select: none;
            transition: all 0.8s ease-out;
        }
    </style>
</head>
<body>
    <h1>Тапай кота!</h1>
    <img id="cookie" src="/images/cat-breakdance.gif" alt="Click!" onclick="clickCookie(event)">
    <p id="score">Деньги: <span id="scoreValue">0</span></p>
    <p id="clickValue">Один клик: 1</p>

    <div class="section">
        <h2>Улучшения</h2>
        <button class="button" id="upgrade0" onclick="buyUpgrade(0)">+1 клик (10)</button>
        <button class="button" id="upgrade1" onclick="buyUpgrade(1)">+3 клика (25)</button>
    </div>

    <div class="section">
        <h2>Автокликер</h2>
        <p id="autoClickerStatus">Автокликер: Выкл.</p>
        <button class="button" onclick="buyAutoClicker(50)">Купить автокликер (50)</button>
        <button class="button" onclick="upgradeAutoClicker(30)">Улучшить автокликер (30)</button>
    </div>

    <div class="section">
        <h2>Питомцы</h2>
        <div id="petContainer"></div>
    </div>

    <div class="section">
        <h2>Достижения</h2>
        <p class="achievement" id="achvClicks">100 кликов</p>
        <p class="achievement" id="achvUpgrades">5 улучшений</p>
        <p class="achievement" id="achvAuto">Автокликер включен</p>
    </div>

    <div class="section">
        <h2>Перерождение</h2>
        <p>Уровень перерождения: <span id="rebirthLevelDisplay">0</span></p>
        <button class="button" onclick="rebirth()">Сделать перерождение (10000)</button>
    </div>

    <div class="section">
        <h2>Сохранение</h2>
        <button class="button" onclick="saveGame()">Сохранить</button>
        <button class="button" onclick="loadGame()">Загрузить</button>
        <button class="button" onclick="resetGame()">Сброс</button>
    </div>

    <script>
        let score = 0;
        let clickValue = 1;
        let upgradeCount = 0;
        let bonusActive = false;
        let rebirthLevel = 0;
        const baseUpgradeCosts = [10, 25];
        let upgradeLevels = [0, 0];
        let autoClicker = { enabled: false, speed: 1, interval: null };
        const pets = [
            { name: "kolbasa", cost: 100, boost: 0.1, owned: false },
            { name: "shaurma", cost: 250, boost: 0.25, owned: false },
            { name: "doggo", cost: 500, boost: 0.5, owned: false, requiredRebirth: 1 },
            { name: "birb", cost: 1000, boost: 1.0, owned: false, requiredRebirth: 2 },
            { name: "dragon", cost: 5000, boost: 2.5, owned: false, requiredRebirth: 3 }
        ];

        function updateUI() {
            document.getElementById("scoreValue").textContent = Math.floor(score);
            document.getElementById("clickValue").textContent = "Один клик: " + clickValue.toFixed(2);
            document.getElementById("autoClickerStatus").textContent = "Автокликер: " + (autoClicker.enabled ? "Вкл." : "Выкл.");
            document.getElementById("rebirthLevelDisplay").textContent = rebirthLevel;
            baseUpgradeCosts.forEach((cost, index) => {
                const realCost = Math.floor(cost * Math.pow(1.15, upgradeLevels[index]));
                document.getElementById("upgrade" + index).textContent = (index === 0 ? "+1" : "+3") + ` клик (${realCost})`;
            });
        }

        function clickCookie(e) {
            score += clickValue;
            updateUI();
            checkAchievements();
            spawnParticle(e.clientX, e.clientY);
        }

        function spawnParticle(x, y) {
            const particle = document.createElement("div");
            particle.className = "particle";
            particle.style.left = x + "px";
            particle.style.top = y + "px";
            particle.textContent = "+" + clickValue.toFixed(1);
            document.body.appendChild(particle);
            requestAnimationFrame(() => {
                particle.style.top = (y - 50) + "px";
                particle.style.opacity = 0;
            });
            setTimeout(() => particle.remove(), 800);
        }

        function buyUpgrade(index) {
            const baseCost = baseUpgradeCosts[index];
            const cost = Math.floor(baseCost * Math.pow(1.15, upgradeLevels[index]));
            const value = index === 0 ? 1 : 3;
            if (score >= cost) {
                score -= cost;
                clickValue += value;
                upgradeCount++;
                upgradeLevels[index]++;
                updateUI();
                checkAchievements();
            } else alert("Недостаточно денег!");
        }

        function buyAutoClicker(cost) {
            if (!autoClicker.enabled && score >= cost) {
                score -= cost;
                autoClicker.enabled = true;
                startAutoClicker();
                updateUI();
                checkAchievements();
            } else alert("Недостаточно денег или уже куплен!");
        }

        function upgradeAutoClicker(cost) {
            if (autoClicker.enabled && score >= cost) {
                score -= cost;
                autoClicker.speed++;
                startAutoClicker();
                updateUI();
            } else alert("Купите автокликер сначала или недостаточно денег.");
        }

        function startAutoClicker() {
            clearInterval(autoClicker.interval);
            autoClicker.interval = setInterval(() => {
                score += clickValue;
                updateUI();
                checkAchievements();
            }, 1000 / autoClicker.speed);
        }

        function checkAchievements() {
            if (score >= 100) document.getElementById("achvClicks").classList.add("unlocked");
            if (upgradeCount >= 5) document.getElementById("achvUpgrades").classList.add("unlocked");
            if (autoClicker.enabled) document.getElementById("achvAuto").classList.add("unlocked");
        }

        function showPets() {
            const petContainer = document.getElementById("petContainer");
            petContainer.innerHTML = "";
            pets.forEach(pet => {
                const btn = document.createElement("button");
                btn.className = "button";
                if (pet.requiredRebirth && rebirthLevel < pet.requiredRebirth) {
                    btn.textContent = `${pet.name} (Требуется перерождение ${pet.requiredRebirth})`;
                    btn.disabled = true;
                } else {
                    btn.textContent = pet.owned ? `${pet.name} — Активен` : `${pet.name} (${pet.cost})`;
                    btn.disabled = pet.owned;
                    btn.onclick = () => {
                        if (score >= pet.cost) {
                            score -= pet.cost;
                            pet.owned = true;
                            clickValue += pet.boost;
                            updateUI();
                            showPets();
                        } else alert("Недостаточно денег!");
                    };
                }
                petContainer.appendChild(btn);
            });
        }

        function rebirth() {
            if (score >= 10000) {
                if (confirm("Вы уверены, что хотите сделать перерождение? Всё будет сброшено, но вы получите бонус!")) {
                    rebirthLevel++;
                    score = 0;
                    clickValue = 1 + rebirthLevel * 0.5;
                    upgradeCount = 0;
                    upgradeLevels = [0, 0];
                    autoClicker = { enabled: false, speed: 1, interval: null };
                    pets.forEach(p => p.owned = false);
                    updateUI();
                    showPets();
                    clearInterval(autoClicker.interval);
                    localStorage.removeItem("catClickerSave");
                }
            } else alert("Нужно минимум 10000 денег для перерождения!");
        }

        function activateBonus() {
            if (bonusActive) return;
            bonusActive = true;
            clickValue *= 2;
            document.body.style.background = "#fff5d7";
            setTimeout(() => {
                clickValue /= 2;
                bonusActive = false;
                document.body.style.background = "";
                updateUI();
            }, 10000);
        }

        function enhancedBonusChance() {
            return 0.15 + rebirthLevel * 0.05;
        }

        setInterval(() => {
            if (Math.random() < enhancedBonusChance()) {
                const bonusBtn = document.createElement("button");
                bonusBtn.textContent = "BONUS!";
                bonusBtn.className = "button";
                bonusBtn.style.position = "fixed";
                bonusBtn.style.top = Math.random() * 80 + "%";
                bonusBtn.style.left = Math.random() * 80 + "%";
                bonusBtn.onclick = () => {
                    activateBonus();
                    bonusBtn.remove();
                };
                document.body.appendChild(bonusBtn);
                setTimeout(() => bonusBtn.remove(), 7000);
            }
        }, 20000);

        function saveGame() {
            const data = { score, clickValue, upgradeCount, autoClicker, pets, rebirthLevel, upgradeLevels };
            localStorage.setItem("catClickerSave", JSON.stringify(data));
        }

        function loadGame() {
            const saved = JSON.parse(localStorage.getItem("catClickerSave"));
            if (saved) {
                score = saved.score;
                clickValue = saved.clickValue;
                upgradeCount = saved.upgradeCount;
                autoClicker = saved.autoClicker;
                rebirthLevel = saved.rebirthLevel || 0;
                upgradeLevels = saved.upgradeLevels || [0, 0];
                pets.forEach((p, i) => pets[i].owned = saved.pets[i]?.owned || false);
                if (autoClicker.enabled) startAutoClicker();
                updateUI();
                showPets();
                checkAchievements();
            }
        }

        function resetGame() {
            if (confirm("Вы уверены, что хотите сбросить игру?")) {
                localStorage.removeItem("catClickerSave");
                location.reload();
            }
        }

        setInterval(saveGame, 15000);
        window.onload = () => {
            loadGame();
            showPets();
        };
    </script>
</body>
</html>
